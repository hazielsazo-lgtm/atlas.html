<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>ATLAS - Albion Online</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Favicon: SVG brÃºjula/atlas embebido como data URI -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3CradialGradient id='g' cx='50%25' cy='35%25' r='70%25'%3E%3Cstop offset='0%25' stop-color='%23f6e5b3'/%3E%3Cstop offset='100%25' stop-color='%23c29b2d'/%3E%3C/radialGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='20' fill='%23362f22'/%3E%3Ccircle cx='50' cy='45' r='28' fill='url(%23g)' stroke='%23704d1b' stroke-width='3'/%3E%3Cpath d='M50 20 L58 52 L50 48 L42 52 Z' fill='%23312b22' transform='rotate(18 50 45)'/%3E%3Ccircle cx='50' cy='45' r='6' fill='%231b1208'/%3E%3C/svg%3E" type="image/svg+xml">

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&display=swap');

    :root{
      --gold-1:#d4af37; --gold-2:#c29b2d;
      --bg-dark:#0f0f10; --bg-light:#f3efe1;
      --panel-dark:rgba(0,0,0,0.72); --panel-light:rgba(255,255,245,0.92);
      --accent-ho:#0b66ff; --accent-hq:#23a34a; --danger:#e53935;
      --text-light:#f7f2ea; --text-dark:#111;
      --muted: rgba(255,255,255,0.65);
    }

    html,body{height:100%;margin:0;padding:0;font-family:"Cinzel",serif}
    body{
      background: linear-gradient(180deg,var(--bg-dark),#070707);
      color:var(--text-light);
      min-height:100vh;
      padding:20px;
      display:flex;
      justify-content:center;
      box-sizing:border-box;
      transition:background .25s,color .25s;
    }
    body.light{
      background: var(--bg-light);
      color:var(--text-dark);
    }

    .container{
      width:100%;
      max-width:980px;
      background:var(--panel-dark);
      border-radius:12px;
      padding:18px;
      box-shadow:0 10px 30px rgba(0,0,0,0.6);
      backdrop-filter:blur(4px);
    }
    body.light .container{ background:var(--panel-light); box-shadow:0 8px 18px rgba(0,0,0,0.08); }

    .header-row{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:14px; flex-wrap:wrap;}
    h1{ margin:0; font-size:26px; letter-spacing:1px; background:linear-gradient(90deg,var(--gold-1),var(--gold-2)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; display:flex; align-items:center; gap:10px; }

    /* small switch */
    .theme-switch{ display:flex; align-items:center; gap:8px; font-size:13px; user-select:none; }
    .switch{ width:44px; height:22px; background:rgba(255,255,255,0.12); border-radius:999px; position:relative; cursor:pointer; }
    body.light .switch{ background:rgba(0,0,0,0.06); }
    .knob{ position:absolute; top:2px; left:2px; width:18px; height:18px; border-radius:50%; background:linear-gradient(180deg,#fff,#ddd); box-shadow:0 2px 6px rgba(0,0,0,0.25); transition:left .18s; }
    .switch.on .knob{ left:24px; }

    .controls{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }

    input[type="text"], select {
      width:100%; padding:10px 12px; border-radius:6px; border:1px solid rgba(0,0,0,0.12);
      background: rgba(255,255,255,0.02); color:inherit; box-sizing:border-box; font-size:14px;
    }
    body.light input[type="text"], body.light select { background: rgba(0,0,0,0.02); color:var(--text-dark); }

    .btn{ padding:10px 12px; border-radius:8px; border:none; cursor:pointer; font-weight:700; }
    .btn.small{ padding:7px 10px; font-size:13px; }
    .btn.save{ background:linear-gradient(90deg,var(--gold-1),var(--gold-2)); color:#111; }
    .btn.load{ background:#8b6f2a; color:white; }
    .btn.add{ background:#2d6a2b; color:white; }
    .btn.gray{ background:#6b6b6b; color:white; }

    .notice{
      margin:14px 0;
      padding:12px;
      border-radius:8px;
      background:rgba(255,255,255,0.03);
      color:var(--muted);
      font-size:14px;
    }

    /* Form area */
    .form{ margin-top:12px; padding-top:12px; border-top:1px dashed rgba(255,255,255,0.04); }
    .form h3{ margin:0 0 8px 0; color:var(--gold-1); }
    .form .top-row{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom:10px; }
    .form input[type="text"]{ flex:1 1 360px; padding:10px; }
    .row-guild{ display:flex; gap:8px; align-items:center; margin-bottom:8px; }
    .row-guild input[type="text"]{ flex:1; padding:8px; }
    .row-guild select{ width:140px; padding:8px; }
    .remove-guild{ background:transparent; color:var(--danger); border:none; cursor:pointer; font-weight:700; padding:6px 8px; }

    .add-guild-btn{ background:rgba(255,255,255,0.03); padding:8px 10px; border-radius:6px; cursor:pointer; color:inherit; border:1px solid rgba(0,0,0,0.06); }

    @media (max-width:760px){
      .header-row{ flex-direction:column; align-items:flex-start; }
      .form .top-row{ flex-direction:column; align-items:stretch; }
      .controls{ width:100%; justify-content:flex-start; }
    }
  </style>
</head>
<body>
  <div class="container" role="application" aria-label="ATLAS - Albion Online">
    <div class="header-row">
      <h1>
        <!-- Mini-Ã­cono en el encabezado (decorativo) -->
        <svg width="28" height="28" viewBox="0 0 100 100" aria-hidden="true" focusable="false" style="filter:drop-shadow(0 2px 6px rgba(0,0,0,0.35));">
          <rect x="6" y="6" width="88" height="88" rx="12" fill="#362f22"/>
          <circle cx="50" cy="45" r="26" fill="#f6e5b3" stroke="#704d1b" stroke-width="3"/>
          <path d="M50 22 L58 54 L50 50 L42 54 Z" fill="#312b22" transform="rotate(18 50 45)"/>
          <circle cx="50" cy="45" r="5" fill="#1b1208"/>
        </svg>
        ATLAS - Albion Online
      </h1>

      <div style="display:flex; gap:12px; align-items:center;">
        <div class="theme-switch" title="Alternar tema">
          <div style="font-size:12px; font-weight:700; opacity:.95">Tema</div>
          <div id="themeSwitch" class="switch" role="button" tabindex="0"><div class="knob"></div></div>
        </div>

        <div class="controls">
          <button id="saveBtn" class="btn save small" title="Exportar JSON (descargar)">ðŸ’¾</button>
          <button id="loadBtn" class="btn load small" title="Importar JSON">ðŸ“‚</button>
          <input id="fileInput" type="file" accept=".json,application/json" style="display:none">
        </div>
      </div>
    </div>

    <div class="notice">
      Esta versiÃ³n de ATLAS no muestra la lista de mapas en pantalla. Puedes usar el formulario para agregar mapas a tu almacenamiento local o importar/exportar JSON.
    </div>

    <!-- AquÃ­ NO mostramos la tabla de mapas (solicitado: "sin los mapas") -->

    <div class="form" id="editor">
      <h3>Agregar / Editar (guardado local)</h3>

      <div class="top-row">
        <input id="mapInput" type="text" placeholder="Nombre del mapa (ej. Sunfang Cliffs)">
        <button id="addGuildRow" class="add-guild-btn">+ Agregar gremio</button>
      </div>

      <div id="guildListContainer" aria-label="Lista de gremios para el formulario" style="margin-bottom:8px"></div>

      <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px;">
        <button id="applyBtn" class="btn add">Agregar / Guardar</button>
        <button id="saveLocalBtn" class="btn gray small">Guardar en Atlas (local)</button>
        <button id="clearForm" class="btn small">Limpiar</button>
      </div>

      <p style="margin-top:10px; color:var(--muted); font-size:13px;">
        Los mapas se guardan en el <strong>localStorage</strong> del navegador y no se muestran aquÃ­.
        Puedes exportar los datos como .json usando ðŸ’¾ o importarlos con ðŸ“‚.
      </p>
    </div>
  </div>

  <script>
    // --- estado y referencias ---
    let data = JSON.parse(localStorage.getItem('albionData')) || [];
    let editingMap = null;
    const searchInput = null; // no hay bÃºsqueda visual en esta versiÃ³n
    const saveBtn = document.getElementById('saveBtn');
    const loadBtn = document.getElementById('loadBtn');
    const fileInput = document.getElementById('fileInput');
    const themeSwitch = document.getElementById('themeSwitch');
    const bodyEl = document.body;

    const mapInput = document.getElementById('mapInput');
    const guildListContainer = document.getElementById('guildListContainer');
    const addGuildRowBtn = document.getElementById('addGuildRow');
    const applyBtn = document.getElementById('applyBtn');
    const saveLocalBtn = document.getElementById('saveLocalBtn');
    const clearFormBtn = document.getElementById('clearForm');

    // --- helpers para filas de gremio en form ---
    function createGuildFormRow(name = '', type = 'HO') {
      const wrapper = document.createElement('div');
      wrapper.className = 'row-guild';

      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = 'Nombre del gremio';
      input.value = name;

      const select = document.createElement('select');
      select.add(new Option('HO (Hideout)', 'HO'));
      select.add(new Option('HQ (Headquarters)', 'HQ'));
      select.value = type;

      const removeBtn = document.createElement('button');
      removeBtn.type = 'button';
      removeBtn.className = 'remove-guild';
      removeBtn.title = 'Eliminar este gremio';
      removeBtn.textContent = 'X';
      removeBtn.onclick = () => wrapper.remove();

      wrapper.appendChild(input);
      wrapper.appendChild(select);
      wrapper.appendChild(removeBtn);
      return wrapper;
    }

    function clearGuildForm() {
      guildListContainer.innerHTML = '';
      guildListContainer.appendChild(createGuildFormRow('', 'HO'));
    }

    addGuildRowBtn.addEventListener('click', (e) => { e.preventDefault(); guildListContainer.appendChild(createGuildFormRow('', 'HO')); });
    clearFormBtn.addEventListener('click', () => { editingMap = null; mapInput.value = ''; clearGuildForm(); });

    // --- aplicar agregar / editar --- (guardamos en localStorage, pero NO mostramos)
    applyBtn.addEventListener('click', () => {
      const mapName = mapInput.value.trim();
      if (!mapName) {
        Swal.fire('Falta nombre', 'Escribe el nombre del mapa', 'warning');
        return;
      }

      const rows = Array.from(guildListContainer.children).map(row => {
        const name = (row.querySelector('input[type="text"]').value || '').trim();
        const type = (row.querySelector('select').value || 'HO');
        return { name, type };
      }).filter(g => g.name);

      if (rows.length === 0) {
        Swal.fire('Falta gremio', 'Agrega al menos un gremio con tipo HO/HQ', 'warning');
        return;
      }

      const now = new Date().toLocaleString();
      const idx = data.findIndex(d => d.map.toLowerCase() === (editingMap || mapName).toLowerCase());

      if (idx >= 0) {
        data[idx].map = mapName;
        data[idx].guilds = rows;
        data[idx].lastEdited = now;
        Swal.fire('Actualizado', 'Mapa actualizado en almacenamiento local', 'success');
      } else {
        data.push({ map: mapName, guilds: rows, lastEdited: now });
        Swal.fire('Agregado', 'Mapa guardado en almacenamiento local', 'success');
      }

      editingMap = null;
      persist();
      mapInput.value = '';
      clearGuildForm();
    });

    // --- persistencia local + export/import ---
    function persist() { localStorage.setItem('albionData', JSON.stringify(data)); }

    saveLocalBtn.addEventListener('click', () => {
      persist();
      Swal.fire('Guardado', 'Datos guardados en localStorage', 'success');
    });

    saveBtn.addEventListener('click', () => {
      try {
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `atlas_albion_${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
        Swal.fire('âœ… Archivo descargado', 'ExportaciÃ³n completada', 'success');
      } catch (err) {
        console.error(err);
        Swal.fire('Error', 'No se pudo generar el archivo', 'error');
      }
    });

    loadBtn.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', (e) => {
      const f = e.target.files[0];
      if (!f) return;
      const reader = new FileReader();
      reader.onload = (ev) => {
        try {
          let text = ev.target.result;
          if (text.charCodeAt(0) === 0xFEFF) text = text.slice(1);
          text = text.trim();
          const parsed = JSON.parse(text);
          if (!Array.isArray(parsed)) throw new Error('Se esperaba un array');
          data = parsed;
          persist();
          Swal.fire('âœ… Cargado', 'Datos importados correctamente', 'success');
        } catch (err) {
          console.error('Error parseando JSON:', err);
          Swal.fire('âŒ Error', 'No se pudo leer el archivo JSON o el formato es incorrecto', 'error');
        } finally {
          fileInput.value = '';
        }
      };
      reader.onerror = () => { Swal.fire('âŒ Error', 'No se pudo leer el archivo', 'error'); fileInput.value = ''; };
      reader.readAsText(f, 'UTF-8');
    });

    // --- tema (palanca) ---
    function applyTheme(theme) {
      const light = theme === 'light';
      bodyEl.classList.toggle('light', light);
      themeSwitch.classList.toggle('on', light);
      localStorage.setItem('theme', theme);
    }
    themeSwitch.addEventListener('click', () => {
      const newT = bodyEl.classList.contains('light') ? 'dark' : 'light';
      applyTheme(newT);
    });
    themeSwitch.addEventListener('keydown', (e) => { if (e.key === ' ' || e.key === 'Enter') { e.preventDefault(); themeSwitch.click(); }});
    applyTheme(localStorage.getItem('theme') || 'dark');

    // inicializar form vacÃ­o
    clearGuildForm();

    // NOTA: en esta versiÃ³n intencionalmente no renderizamos la lista de mapas en pantalla.
  </script>
</body>
</html>
